#define( $headerMarkup )

	<style type="text/css">
		@import "script/jqueryplugins-latest/dataTables/media/css/ig_table.css";
	</style>
	<script type="text/javascript" language="javascript" src="script/jqueryplugins-latest/dataTables/media/js/jquery.dataTables.min.js"></script>

	<script type="text/javascript">
	<!-- 
		var isClicked = false;
		function changeComponent(componentId)
	    {
	    	//alert("siteNodeId: $siteNodeId");
	    	//alert("languageId: $languageId");
	    	//alert("parentComponentId: $!parentComponentId");
	    	//alert("contentId: $!contentId");
	    	//alert("$slotId: $slotId");
	    	//alert("componentId:" + componentId);
			if(!isClicked){
				isClicked = true;
		    	url = "ViewSiteNodePageComponents!changeComponent.action?siteNodeId=$siteNodeId&languageId=$languageId&contentId=$contentId&componentId=$!componentId&newComponentContentId=" + componentId + "&slotId=$slotId&specifyBaseTemplate=$!specifyBaseTemplate&showSimple=$showSimple";
			    //alert("url" + url);
		    	parent.location.href = url;
		    }
	    }
	
		function changeRepository(selectBox)
		{
			var repositoryId = selectBox.value;
			var url = "ViewSiteNodePageComponents!listComponentsForChange.action?siteNodeId=$siteNodeId&languageId=$languageId&contentId=$contentId&parentComponentId=$!parentComponentId&slotId=$slotId&componentId=$!componentId&specifyBaseTemplate=$!specifyBaseTemplate&showSimple=$showSimple&$allowedComponentNamesAsUrlEncodedString&$disallowedComponentNamesAsUrlEncodedString&$allowedComponentGroupNamesAsUrlEncodedString&filterRepositoryId=" + repositoryId;
			//alert("url:" + url);
			document.location.href = url;
		}

		function toggleDiv(id)
		{
			var div = document.getElementById(id);
			if(div.style.display == 'none')
				div.style.display = 'block';
			else
				div.style.display = 'none';
		}

		
		$(document).ready(function(){

			#set($extraParameter = '')
			#if($useSimpleComponentDialog)
			#set($extraParameter = '"aoColumns": [ { "sWidth": "30px" }, null ], "iDisplayLength": 10')
			#end
			#initDataTableImpl("dataTable" $extraParameter)
			
			$("#dataTable_filter :text").focus();
		});
	-->
	</script>
#end

#beginLightCommonToolV3Impl("tool.structuretool.chooseComponentToAddTitle" "$!siteNodeId" "" false true $!disableCloseButton $headerMarkup false "")

#lightMenuToolbar("" $buttons $rightButtons) 

<div style="clear: both;"></div>

<h3>$ui.getString("tool.structuretool.clickComponentToChangeToLabel")</h3>
#if(!$useSimpleComponentDialog)
<p>
	#set($allRepositories = $repositories)
    	
	$ui.getString("tool.structuretool.addComponentChangeRepositoryLabel")
	<select size="1" name="repositoryId" class="sitedropbox" onChange="javascript:changeRepository(this);" class="contenttool">
	    <option value="-1" #if($repositoryVO.id == $filterRepositoryId) selected="1" #end>$ui.getString("tool.structuretool.allRepostoriesLabel")</option>
	    #foreach ($repositoryVO in $allRepositories)
	    <option value="$repositoryVO.getRepositoryId()" #if($repositoryVO.id == $filterRepositoryId) selected="1" #end>$repositoryVO.getName()</option>
	    #end
	</select>
</p>

<p>
	$ui.getString("tool.structuretool.changeComponentMethod.label")
	<select size="1" name="changeMethod" class="sitedropbox" class="contenttool">
	    <option value="matchComponentIdAndSlotName">$ui.getString("tool.structuretool.changeComponentMethod.matchComponentIdAndSlotName.label")</option>
	    <option value="matchComponentId">$ui.getString("tool.structuretool.changeComponentMethod.matchComponentId.label")</option>
	    <option value="matchComponentContentId">$ui.getString("tool.structuretool.changeComponentMethod.matchComponentContentId.label")</option>
	</select>
</p>
<p>
	$ui.getString("tool.structuretool.changeComponentRecursionOptions.label")
	<select size="1" name="recursionMethod" class="sitedropbox" class="contenttool">
	    <option value="onlyThisPage">$ui.getString("tool.structuretool.changeComponentRecursionOptions.onlyThisPage.label")</option>
	    <option value="thisAndSubpages">$ui.getString("tool.structuretool.changeComponentRecursionOptions.thisAndSubpages.label")</option>
	    <option value="theEntireRepository">$ui.getString("tool.structuretool.changeComponentRecursionOptions.theEntireRepository.label")</option>
	</select>
</p>

#end

<div id="igEditArea" class="igScrollArea" onfocus="this.blur();">
	
	<table cellpadding="0" cellspacing="0" border="1" class="display" id="dataTable">
		<thead>
			<tr>
				<th>&nbsp;</th>
				<th>$ui.getString("tool.structuretool.componentNameLabel")</th>
				#if(!$useSimpleComponentDialog)
				<th>$ui.getString("tool.structuretool.repositoryLabel")</th>
				<th>$ui.getString("tool.structuretool.groupNameLabel")</th>
				#end
			</tr>
		</thead>
		<tbody>
			
		#set($prevId = -1)
		#set($sortedComponents = $this.getSortedComponents($sortProperty))
		#foreach ($content in $sortedComponents)
			#set($duplicate = false)
			#if($prevId == $content.id)
				#set($duplicate = true)
			#end
			#set($prevId = $content.id)
			
			#set($hasAccessToContent = true)
			#if($content.isProtected == 1)
				#set($hasAccessToContent = $this.hasAccessTo("Component.Select", "$content.id"))
			#end
			
			#if($hasAccessToContent && !$duplicate && ($filterRepositoryId == -1 || $content.repositoryId == $filterRepositoryId || $this.getIsPagePartTemplate($content.contentTypeDefinitionId)))

				#set($imageUrl = $this.getDigitalAssetUrl($content.id, "thumbnail"))
				#if("$!imageUrl" == "")
					#set($imageUrl = "css/images/componentIcon.gif")
				#end
				<tr>
					#if($imageUrl.indexOf("componentIcon.gif") > -1)
						#set($width = "16")
					#else
						#set($width = "40")
					#end
					<td align="center"><a href="javascript:changeComponent('$content.id');"><img src="$imageUrl" border="0" width="$width"></a>&nbsp;</td>
					<td>
						<a href="javascript:changeComponent('$content.id');">$content.getName()</a><br/><br/>
						#if($content.extraProperties.get("Description") != "Unknown" && $content.extraProperties.get("Description") != "")
						<span id="descLayer$content.id" style="margin-top: 4px;"><b>$ui.getString("tool.structuretool.descriptionLabel"):</b><br/>
						#if($content.extraProperties.get("Description"))
							$content.extraProperties.get("Description")
						#else
							No description
						#end
						</span>
						#end
					</td>
					#if(!$useSimpleComponentDialog)
					<td>
						#foreach ($repositoryVO in $allRepositories)
					    	#if($repositoryVO.id == $content.repositoryId)
					    		$repositoryVO.getName()
					    	#end
					    #end
					</td>
					<td>$content.extraProperties.get("GroupName").replaceAll(",","<br/>")</td>
					#end
				</tr>
				#set($imageUrl = "")
			#end
		#end
			
		</tbody>
	</table>

</div>

#lightFooterToolbar($footerButtons)
	
#endCommonToolV3()